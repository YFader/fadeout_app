import { migrate, client } from '../shared/db.js'; import { requireAuth } from '../shared/auth.js';
export default async function handler(req,res){ try{ await migrate(); const userId=requireAuth(req); const id=req.query.id; const db=await client(); const { rows }=await db.query(`SELECT b.*, r.name, r.code FROM bookings b JOIN rooms r ON r.id=b.room_id WHERE b.id=? AND b.user_id=?`, [id, userId]); if(!rows.length) return res.status(404).json({ error:'Бронь не найдена' }); res.status(200).json(rows[0]); } catch(e){ res.status(500).json({ error:e.message }); } }