import { migrate, client } from '../shared/db.js'; import { requireAuth } from '../shared/auth.js';
export default async function handler(req,res){ try{ if(req.method!=='POST') return res.status(405).end(); await migrate(); const invitedUserId=requireAuth(req); const code=req.query.code; const db=await client(); const row=(await db.query("SELECT * FROM booking_invites WHERE invite_code=? AND status='pending'",[code])).rows[0]; if(!row) return res.status(404).json({ error:'Приглашение не найдено/просрочено' }); await db.execute('UPDATE booking_invites SET invited_user_id=?, status=? WHERE id=?',[invitedUserId,'accepted',row.id]); res.status(200).json({ success:true }); } catch(e){ res.status(500).json({ error:e.message }); } }